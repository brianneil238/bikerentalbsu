(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{9661:function(e,t,a){Promise.resolve().then(a.bind(a,2193))},4232:function(e,t,a){"use strict";a.d(t,{default:function(){return s.a}});var l=a(4930),s=a.n(l)},4930:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let l=a(6921);a(3827),a(4090);let s=l._(a(4795));function r(e,t){let a={loading:e=>{let{error:t,isLoading:a,pastDelay:l}=e;return null}};return"function"==typeof e&&(a.loader=e),(0,s.default)({...a,...t})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},9721:function(e,t,a){"use strict";function l(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return l}}),a(9775)},4795:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let l=a(3827),s=a(4090),r=a(9721);function n(e){var t;return{default:null!=(t=null==e?void 0:e.default)?t:e}}let i={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},a=(0,s.lazy)(()=>t.loader().then(n)),o=t.loading;function d(e){let n=o?(0,l.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=t.ssr?(0,l.jsx)(a,{...e}):(0,l.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(a,{...e})});return(0,l.jsx)(s.Suspense,{fallback:n,children:i})}return d.displayName="LoadableComponent",d}},2193:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return i}});var l=a(3827),s=a(4090),r=a(1126);let n=(0,a(4232).default)(()=>a.e(569).then(a.bind(a,2569)),{loadableGenerated:{webpack:()=>[2569]},ssr:!1,loading:()=>(0,l.jsx)("div",{className:"h-[400px] bg-gray-100 animate-pulse rounded-lg"})});function i(){var e;let{data:t,status:a}=(0,r.useSession)(),[i,o]=(0,s.useState)([]),[d,u]=(0,s.useState)(null),[c,m]=(0,s.useState)(!0),[h,p]=(0,s.useState)(null),[x,b]=(0,s.useState)(""),[g,f]=(0,s.useState)(""),[j,v]=(0,s.useState)(""),[N,y]=(0,s.useState)(""),[k,S]=(0,s.useState)(""),[F,C]=(0,s.useState)(""),[w,O]=(0,s.useState)(""),[P,D]=(0,s.useState)((null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email)||""),[A,E]=(0,s.useState)(""),[_,L]=(0,s.useState)(""),[q,B]=(0,s.useState)(""),[I,R]=(0,s.useState)(""),[M,T]=(0,s.useState)(""),[U,G]=(0,s.useState)(""),[J,V]=(0,s.useState)(""),[z,H]=(0,s.useState)(""),[W,K]=(0,s.useState)(""),[Q,X]=(0,s.useState)(""),[Y,Z]=(0,s.useState)(""),[$,ee]=(0,s.useState)(!1),[et,ea]=(0,s.useState)(null),[el,es]=(0,s.useState)(null),[er,en]=(0,s.useState)(!1),[ei,eo]=(0,s.useState)(null),[ed,eu]=(0,s.useState)(null);(0,s.useEffect)(()=>{ec();let e=setInterval(ec,3e4);return()=>clearInterval(e)},[t]);let ec=async()=>{try{let e=await fetch("/api/bikes");if(!e.ok)throw Error("Failed to fetch bikes");let t=await e.json();o(t)}catch(e){p("Failed to load bikes. Please try again later.")}finally{m(!1)}},em=async e=>{try{var a;let l=await fetch("/api/rentals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bikeId:e})});if(!l.ok){let e=await l.json();throw Error(e.message)}let s=await l.json();(null==t?void 0:null===(a=t.user)||void 0===a?void 0:a.id)&&(null==s?void 0:s.id)&&await eh(t.user.id,s.id),ec(),window.location.href="/rent/active"}catch(e){p(e instanceof Error?e.message:"Failed to rent bike")}},eh=async(e,t)=>{ee(!0),ea(null),es(null),console.log("Generating PDF for userId:",e,"and rentalId:",t);try{let a=await fetch("/api/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({formData:{lastName:x,firstName:g,middleName:j,srCode:N,sex:k,dateOfBirth:F,phoneNumber:w,emailAddress:P,collegeProgram:A,gwaLastSemester:_,extracurricularActivities:q,houseNo:I,streetName:M,barangay:U,municipalityCity:J,province:z,distanceFromCampus:W,monthlyFamilyIncome:Q,durationOfUse:Y},userId:e,rentalId:t})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to generate PDF")}let l=await a.blob(),s=URL.createObjectURL(l);ea(s)}catch(e){es(e instanceof Error?e.message:"An unexpected error occurred.")}finally{ee(!1)}},ep=async e=>{e.preventDefault(),console.log("\uD83C\uDFAF Form submitted!"),en(!0),eu(null),eo(null);try{console.log("\uD83D\uDCE4 Sending application data...");let e=await fetch("/api/applications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:g,lastName:x,middleName:j,srCode:N,sex:k,dateOfBirth:F,phoneNumber:w,email:P,collegeProgram:A,gwaLastSemester:_?parseFloat(_):null,extracurricularActivities:q,houseNo:I,streetName:M,barangay:U,municipalityCity:J,province:z,distanceFromCampus:W,monthlyFamilyIncome:Q?parseFloat(Q):null,durationOfUse:Y})});if(!e.ok){let t=await e.json();throw console.error("❌ API Error:",e.status,t),Error(t.message||"Failed to submit application")}let t=await e.json();console.log("✅ Application submitted successfully:",t),eo(t.message)}catch(e){eu(e instanceof Error?e.message:"Failed to submit application")}finally{en(!1)}};return(0,l.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold mb-8 text-green-800",children:"Rent a Bike"}),h&&(0,l.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-6",children:h}),(0,l.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,l.jsx)("div",{className:"lg:col-span-2",children:(0,l.jsxs)("div",{className:"card p-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Available Bikes"}),(0,l.jsx)("div",{className:"h-[600px] rounded-lg overflow-hidden",children:(0,l.jsx)(n,{bikes:i,selectedBike:d,onBikeSelect:u})})]})}),(0,l.jsxs)("div",{className:"card p-4",children:[(0,l.jsx)("h2",{className:"text-xl font-semibold mb-4 text-green-800",children:"Bike List"}),c?(0,l.jsx)("div",{className:"space-y-4",children:[1,2,3].map(e=>(0,l.jsx)("div",{className:"h-24 bg-gray-100 animate-pulse rounded-lg"},e))}):(0,l.jsx)("div",{className:"space-y-4",children:i.map(e=>(0,l.jsx)("div",{className:"p-4 rounded-lg border ".concat((null==d?void 0:d.id)===e.id?"border-green-500 bg-green-50":"border-green-200"),children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"font-semibold text-green-800",children:["Bike #",e.bikeNumber]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.model}),(0,l.jsx)("span",{className:"inline-block px-2 py-1 text-xs rounded-full ".concat("AVAILABLE"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),"AVAILABLE"===e.status&&(0,l.jsx)("button",{onClick:()=>em(e.id),className:"btn-primary",children:"Rent"})]})},e.id))})]})]}),(0,l.jsxs)("div",{className:"mt-12 card p-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6 text-green-800",children:"Bike Rental Application Form"}),(0,l.jsx)("p",{className:"text-gray-600 mb-6",children:"Please fill out the form below to generate your official application document."}),ed&&(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-6",children:["Error submitting application: ",ed]}),ei&&(0,l.jsx)("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg mb-6",children:(0,l.jsx)("p",{className:"font-semibold",children:ei})}),el&&(0,l.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg mb-6",children:["Error generating PDF: ",el]}),et&&(0,l.jsxs)("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg mb-6",children:[(0,l.jsx)("p",{className:"font-semibold mb-2",children:"PDF generated successfully!"}),(0,l.jsx)("a",{href:et,target:"_blank",rel:"noopener noreferrer",className:"text-green-700 hover:underline",children:"Download your application PDF"})]}),(0,l.jsx)("button",{onClick:async()=>{try{let e=await fetch("/api/pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templatePath:"public/templates/rental_agreement_template.docx",formData:{firstName:g,lastName:x,middleName:j,srCode:N,sex:k,dateOfBirth:F,phoneNumber:w,emailAddress:P,collegeProgram:A,gwaLastSemester:_,extracurricularActivities:q,houseNo:I,streetName:M,barangay:U,municipalityCity:J,province:z,distanceFromCampus:W,monthlyFamilyIncome:Q,durationOfUse:Y}})});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to generate PDF")}let t=await e.blob(),a=window.URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download="rental_agreement.pdf",l.click(),window.URL.revokeObjectURL(a)}catch(e){es(e instanceof Error?e.message:"Unknown error")}},className:"btn-primary mb-6",children:"Download Rental Agreement PDF"}),(0,l.jsxs)("form",{onSubmit:ep,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"lastName",className:"block text-sm font-medium text-green-700 mb-1",children:"Last Name"}),(0,l.jsx)("input",{type:"text",id:"lastName",className:"form-input input-short",value:x,onChange:e=>b(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"firstName",className:"block text-sm font-medium text-green-700 mb-1",children:"First Name"}),(0,l.jsx)("input",{type:"text",id:"firstName",className:"form-input input-short",value:g,onChange:e=>f(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"middleName",className:"block text-sm font-medium text-green-700 mb-1",children:"Middle Name"}),(0,l.jsx)("input",{type:"text",id:"middleName",className:"form-input input-short",value:j,onChange:e=>v(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"srCode",className:"block text-sm font-medium text-green-700 mb-1",children:"SR Code"}),(0,l.jsx)("input",{type:"text",id:"srCode",className:"form-input input-short",value:N,onChange:e=>y(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"sex",className:"block text-sm font-medium text-green-700 mb-1",children:"Sex"}),(0,l.jsxs)("select",{id:"sex",className:"form-input input-short",value:k,onChange:e=>S(e.target.value),required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Sex"}),(0,l.jsx)("option",{value:"Male",children:"Male"}),(0,l.jsx)("option",{value:"Female",children:"Female"}),(0,l.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"dateOfBirth",className:"block text-sm font-medium text-green-700 mb-1",children:"Date of Birth"}),(0,l.jsx)("input",{type:"date",id:"dateOfBirth",className:"form-input input-short",value:F,onChange:e=>C(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"phoneNumber",className:"block text-sm font-medium text-green-700 mb-1",children:"Phone Number"}),(0,l.jsx)("input",{type:"tel",id:"phoneNumber",className:"form-input input-short",value:w,onChange:e=>O(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"emailAddress",className:"block text-sm font-medium text-green-700 mb-1",children:"Email Address"}),(0,l.jsx)("input",{type:"email",id:"emailAddress",className:"form-input input-short",value:P,onChange:e=>D(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"collegeProgram",className:"block text-sm font-medium text-green-700 mb-1",children:"College Program"}),(0,l.jsx)("input",{type:"text",id:"collegeProgram",className:"form-input input-short",value:A,onChange:e=>E(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"gwaLastSemester",className:"block text-sm font-medium text-green-700 mb-1",children:"GWA Last Semester"}),(0,l.jsx)("input",{type:"number",id:"gwaLastSemester",step:"0.01",className:"form-input input-short",value:_,onChange:e=>L(e.target.value),required:!0})]}),(0,l.jsxs)("div",{className:"md:col-span-2 lg:col-span-3",children:[(0,l.jsx)("label",{htmlFor:"extracurricularActivities",className:"block text-sm font-medium text-green-700 mb-1",children:"Extracurricular Activities"}),(0,l.jsx)("textarea",{id:"extracurricularActivities",rows:3,className:"form-input input-long",value:q,onChange:e=>B(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"houseNo",className:"block text-sm font-medium text-green-700 mb-1",children:"House Number"}),(0,l.jsx)("input",{type:"text",id:"houseNo",className:"form-input input-short",value:I,onChange:e=>R(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"streetName",className:"block text-sm font-medium text-green-700 mb-1",children:"Street Name"}),(0,l.jsx)("input",{type:"text",id:"streetName",className:"form-input input-short",value:M,onChange:e=>T(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"barangay",className:"block text-sm font-medium text-green-700 mb-1",children:"Barangay"}),(0,l.jsx)("input",{type:"text",id:"barangay",className:"form-input input-short",value:U,onChange:e=>G(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"municipalityCity",className:"block text-sm font-medium text-green-700 mb-1",children:"Municipality/City"}),(0,l.jsx)("input",{type:"text",id:"municipalityCity",className:"form-input input-short",value:J,onChange:e=>V(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"province",className:"block text-sm font-medium text-green-700 mb-1",children:"Province"}),(0,l.jsx)("input",{type:"text",id:"province",className:"form-input input-short",value:z,onChange:e=>H(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"distanceFromCampus",className:"block text-sm font-medium text-green-700 mb-1",children:"Distance from Campus"}),(0,l.jsxs)("select",{id:"distanceFromCampus",className:"form-input input-short",value:W,onChange:e=>K(e.target.value),required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Distance"}),(0,l.jsx)("option",{value:"Less than 1 km",children:"Less than 1 km"}),(0,l.jsx)("option",{value:"1 km but less than 5 km",children:"1 km but less than 5 km"}),(0,l.jsx)("option",{value:"5 km and above",children:"5 km and above"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"monthlyFamilyIncome",className:"block text-sm font-medium text-green-700 mb-1",children:"Monthly Family Income"}),(0,l.jsx)("input",{type:"number",id:"monthlyFamilyIncome",step:"0.01",className:"form-input input-short",value:Q,onChange:e=>X(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"durationOfUse",className:"block text-sm font-medium text-green-700 mb-1",children:"Duration of Use"}),(0,l.jsxs)("select",{id:"durationOfUse",className:"form-input input-short",value:Y,onChange:e=>Z(e.target.value),required:!0,children:[(0,l.jsx)("option",{value:"",children:"Select Duration"}),(0,l.jsx)("option",{value:"One Semester",children:"One Semester"}),(0,l.jsx)("option",{value:"Others",children:"Others"})]})]}),(0,l.jsx)("div",{className:"md:col-span-2 lg:col-span-3",children:(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsx)("button",{type:"submit",disabled:er,className:"btn-primary",children:er?"Submitting Application...":"Submit Application"}),(0,l.jsx)("button",{type:"button",onClick:()=>{var e;(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.id)&&eh(t.user.id,"temp-rental-id")},disabled:$,className:"btn-secondary",children:$?"Generating PDF...":"Generate Application PDF"})]})})]})]})]})}}},function(e){e.O(0,[126,971,69,744],function(){return e(e.s=9661)}),_N_E=e.O()}]);